#!/bin/bash
set -euo pipefail

printf "\n=====================================================================================\n"
printf "KOBITON APP UPLOAD PLUGIN"
printf "\n=====================================================================================\n\n"

export KOBI_USERNAME = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_KOBI_USERNAME"
export KOBI_API_KEY = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_KOBI_API_KEY"
export EXECUTOR_URL = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_EXECUTOR_URL"
export EXECUTOR_USERNAME = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_EXECUTOR_USERNAME"
export EXECUTOR_PASSWORD = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_EXECUTOR_PASSWORD"
export GIT_REPO_URL = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_GIT_REPO_URL"
export GIT_REPO_BRANCH = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_GIT_REPO_BRANCH"
export REPO_SSH_KEY = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_GIT_REPO_SSH_KEY"
export APP_ID = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_APP_ID"
export USE_CUSTOM_DEVICE = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_USE_CUSTOM_DEVICE"
export DEVICE_NAME = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_DEVICE_NAME"
export PLATFORM_VERSION = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_DEVICE_PLATFORM_VERSION"
export DEVICE_PLATFORM = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_DEVICE_PLATFORM"
export ROOT_DIRECTORY = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_ROOT_DIRECTORY"
export COMMAND = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_COMMAND"
export WAIT_FOR_EXECUTION = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_WAIT_FOR_EXECUTION"
export LOG_TYPE = "$BUILDKITE_PLUGIN_KOBITON_EXECUTE_TEST_LOG_TYPE"


printf "EXECUTOR_URL: $EXECUTOR_URL"

$BUILDKITE_PLUGINS_PATH/github-com-Nhattd97-kobiton-execute-test-buildkite-plugin-v1-0-0/build/app

printf "\n=====================================================================================\n"
printf "Uploaded app to kobiton repo with appId: ${APP_ID} and versionId: ${APP_VERSION_ID}\n"
printf "Done."
printf "\n=====================================================================================\n"
